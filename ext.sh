#!/bin/bash

# grep '<h2>' 20121012.htm 20121015.htm 20121016.htm 20121017.htm 20121018.htm \
#   | egrep '1210\.3129|1210\.3209|1210\.3322|1210\.3327|1210\.3340|1210\.3352|1210\.3377|1210\.3392|1210\.3476|1210\.3517|1210\.3615|1210\.3660|1210\.3890|1210\.3905|1210\.3975|1210\.3993|1210\.4113|1210\.4315|1210\.4520|1210\.4588|1210\.4607|1210\.4608|1210\.4655|1210\.4718|1210\.4782' \
#   | sed '
#       s#^.\+<h2>#<li>#
#       s#</h2>$#</li>#
#       s#/icons#http://tkynt2.phys.s.u-tokyo.ac.jp/~murase/icons#
#     '

number='
1211.6835 1211.6911 1211.6912 1211.7024 1211.7048 1211.7162 1211.7173 1211.7298 
1212.0039 1212.0065 1212.0132 1212.0192 1212.0358 1212.0385 1212.0434 1212.0646 
1212.0696 1212.0786 1212.0824 1212.0995 1212.1008 1212.1127'
number='
1212.4907 1212.5308 1212.5388 1212.5393 1212.5427 1212.5475 1212.5489 1212.5857 
1212.5893 1212.5958 1212.6010 1212.6165 1212.6517 1212.6541 1212.6554 1212.6555 
1212.6587 1212.6722 1212.6932 1212.6950 1301.0001 1301.0099 1301.0165 1301.0728 
1301.0786 1301.0880 1301.1375 1301.1581 1301.1644 1301.1761 1301.1789 1301.1828'
number='
1301.2122 1301.2187 1301.2198 1301.2347 1301.2348 1301.2577 1301.2635 1301.2713 
1301.2826 1301.3033 1301.3314 1301.3395 1301.3475 1301.3756 1301.4058 1301.4095 
1301.4361 1301.5285 1301.5323 1301.5557'
number='
1303.7260 1303.7354 1304.0287 1304.0665 1304.0899 1304.1452 1304.1471 1304.1638 
1304.1873 1304.2073 1304.2113 1304.2189 1304.2307 1304.2442 1304.1807 1304.2841 
1304.2852 1304.2876 1304.2897 1304.2969 1304.3243 1304.3286 1304.3403 1304.3634 
1304.3753 1304.3787 1304.3815 1304.4087 1304.4115 1304.4345 1304.4427'

number='
1306.6394
1307.0165 1307.0356 1307.0980 1307.1093 1307.1094
1307.0299 1307.0397 1307.0476 1307.0934 1307.1103'

number='
1406.4760 1406.5097 1406.5103 1406.5225 1406.5322 1406.5463 1406.5541 1406.5733
1406.5781 1406.5811 1406.6019 1406.6296 1406.6405 1406.6784 1406.7222 1406.7522
1406.7774 1406.7792 1406.7819 1407.0140 1407.0264 1407.0378 1407.0383

1407.0404 1407.0629 1407.0837 1407.1077 1407.1554 1407.1782 1407.1849 1407.1903
1407.2047 1407.2191 1407.2233'

number='
1503.03655 1503.03688 1503.03694 1503.03858 1503.03862 1503.03897 1503.03931 1503.04040
1503.04217 1503.04294 1503.04445 1503.04535 1503.04759 1503.05213
'
number='
1410.3299 1411.7268 1502.01331 1503.07478 1503.08110 1504.00184 1504.02175 1504.03992
1505.05985 1505.05987 1505.06166 1505.06335 1505.06456 1505.06714 1505.06766 1505.06853 
1505.07195 1505.07221 1505.07379 1505.07655 1505.07812 1505.07817
'

number='1511.06140 1511.06128 1511.06398 1511.06548 1511.06742 1511.06698 1511.07198
1511.07155 1511.06839 1511.08019 1511.07698 1511.07708 1511.08148 1511.08153
'

function collect_months {
  months=()
  local -A cache
  for n in $@; do
    m="${n%%.*}"
    [[ ${cache[$m]} ]] && continue
    cache[$m]=1
    months+=("$m")
  done
}

months=()
collect_months $number

for n in $number; do
  reg="$reg${reg:+|}${n/./\\.}"
done

extract1 () {
  grep '<h2>' 201212/*.htm 201301??.htm \
    | egrep "$reg" | sed '
        s#^.\+<h2>#<li>#
        s#</h2>\r\?$#</li>#
        s#/agh/icons#http://tkynt2.phys.s.u-tokyo.ac.jp/~murase/icons#
      '
}

extract2 () {
  cat arxiv201[345][01][0-9]??.htm \
    | awk '
        $0~/<h2\y/&&$0~/'"$reg"'/{swch=1;printf "\n";print;next}
        /^[[:space:]]*$/{swch=0;next}
        {if(swch==1)print;next}
      '
}

extract3 () {
  # print title & authors
  #cat arxiv201[345][01][0-9]??.htm
  cat $(find "${months[@]/#/20}" -name \*.htm 2>/dev/null) arxiv20[0-9][0-9][01][0-9][0-3][0-9].htm \
    | awk '
        $0~/<h2\y/&&$0~/'"$reg"'/{swch=1;printf "\n";print;next}
        swch==1 && /<!--/ {swch=2;}
        swch==2 && /-->/ {swch=1;}
        swch==1 && /^[[:space:]]*$|"dateline"|class="abstract/{swch=0;next}
        {if(swch==1)print;next}
      ' | sed 's/<img [^<>]*\/>//'

}

extract3
